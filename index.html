<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinShield - Financial Literacy & Scam Awareness</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        html, body {
            overflow-x: hidden; /* Prevents horizontal scrolling on the main page */
        }
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at top, rgba(230, 0, 115, 0.05), transparent 40%), #F7F8FA;
        }
        /* Custom Colors & Gradients - WHITE & PINK THEME */
        .bg-primary { background-color: #E60073; }
        .text-primary { color: #E60073; }
        .border-primary { border-color: #E60073; }
        .ring-primary { --tw-ring-color: #E60073; }
        .bg-card { 
            background-color: #FFFFFF; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }
        .btn-primary {
            background: linear-gradient(90deg, #E60073 0%, #FF4DA6 100%);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(230, 0, 115, 0.3);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(230, 0, 115, 0.4);
        }
        /* Bottom Nav active state */
        .nav-link.active {
            background-color: #F7F8FA; /* Match background */
        }
        .nav-link.active svg {
            color: #E60073;
        }
        .nav-link.active span {
            color: #E60073;
        }
        /* Hide scrollbar */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        /* Page transition */
        .page {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Authentication Container -->
    <div id="auth-container" class="max-w-md mx-auto p-6">
        <!-- Login Page -->
        <div id="login-page" class="auth-page">
            <div class="text-center mb-8">
                <img src="https://i.imgur.com/80z2Z5c.png" alt="Lulu Mascot" class="w-24 h-24 mx-auto" onerror="this.onerror=null;this.src='https://placehold.co/96x96/E60073/FFFFFF?text=L';">
                <h2 class="text-3xl font-extrabold mt-4">Welcome Back!</h2>
                <p class="text-gray-500">Log in to manage your finances.</p>
            </div>
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="login-email" class="block text-sm font-medium text-gray-600">Email Address</label>
                    <input type="email" id="login-email" class="w-full mt-1 bg-gray-100 border border-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-primary focus:outline-none" required>
                </div>
                <div>
                    <label for="login-password" class="block text-sm font-medium text-gray-600">Password</label>
                    <input type="password" id="login-password" class="w-full mt-1 bg-gray-100 border border-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-primary focus:outline-none" required>
                </div>
                <p id="login-error" class="text-red-500 text-sm hidden"></p>
                <button type="submit" class="w-full btn-primary font-bold py-3 rounded-lg">Log In</button>
            </form>
            <div class="text-center mt-4">
                <a href="#" onclick="showAuthPage('forgot-password-page')" class="text-sm text-primary font-semibold">Forgot Password?</a>
            </div>
            <div class="text-center mt-2">
                <p class="text-sm text-gray-500">Don't have an account? <a href="#" onclick="showAuthPage('register-page')" class="text-primary font-semibold">Register</a></p>
            </div>
        </div>

        <!-- Register Page -->
        <div id="register-page" class="auth-page hidden">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-extrabold">Create Account</h2>
                <p class="text-gray-500">Join FinShield and take control!</p>
            </div>
            <form id="register-form" class="space-y-4">
                <input type="text" id="register-name" placeholder="Full Name" class="w-full bg-gray-100 p-3 rounded-lg" required>
                <input type="email" id="register-email" placeholder="Email Address" class="w-full bg-gray-100 p-3 rounded-lg" required>
                <input type="password" id="register-password" placeholder="Password" class="w-full bg-gray-100 p-3 rounded-lg" required>
                <select id="register-country" class="w-full bg-gray-100 p-3 rounded-lg text-gray-500" required>
                    <option value="" disabled selected>Select your country</option>
                    <option value="Malaysia">Malaysia</option>
                    <option value="Indonesia">Indonesia</option>
                </select>
                <p id="register-error" class="text-red-500 text-sm hidden"></p>
                <button type="submit" class="w-full btn-primary font-bold py-3 rounded-lg">Register</button>
            </form>
            <div class="text-center mt-4">
                <p class="text-sm text-gray-500">Already have an account? <a href="#" onclick="showAuthPage('login-page')" class="text-primary font-semibold">Log In</a></p>
            </div>
        </div>

        <!-- Forgot Password Page -->
        <div id="forgot-password-page" class="auth-page hidden">
             <div class="text-center mb-8">
                <h2 class="text-3xl font-extrabold">Reset Password</h2>
                <p class="text-gray-500">Enter your email to get a reset link.</p>
            </div>
            <form id="forgot-password-form" class="space-y-4">
                <input type="email" id="forgot-email" placeholder="Email Address" class="w-full bg-gray-100 p-3 rounded-lg" required>
                <p id="forgot-error" class="text-red-500 text-sm hidden"></p>
                <div id="forgot-success" class="text-green-600 text-sm hidden bg-green-100 p-3 rounded-lg"></div>
                <button type="submit" class="w-full btn-primary font-bold py-3 rounded-lg">Send Reset Link</button>
            </form>
             <div class="text-center mt-4">
                <a href="#" onclick="showAuthPage('login-page')" class="text-sm text-primary font-semibold">Back to Login</a>
            </div>
        </div>

        <!-- Reset Password Page -->
        <div id="reset-password-page" class="auth-page hidden">
             <div class="text-center mb-8">
                <h2 class="text-3xl font-extrabold">Create New Password</h2>
                <p class="text-gray-500">Enter your new password below.</p>
            </div>
            <form id="reset-password-form" class="space-y-4">
                <input type="password" id="reset-password" placeholder="New Password" class="w-full bg-gray-100 p-3 rounded-lg" required>
                <input type="password" id="reset-password-confirm" placeholder="Confirm New Password" class="w-full bg-gray-100 p-3 rounded-lg" required>
                <p id="reset-error" class="text-red-500 text-sm hidden"></p>
                <button type="submit" class="w-full btn-primary font-bold py-3 rounded-lg">Reset Password</button>
            </form>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="app-container" class="max-w-md mx-auto h-screen flex-col hidden">
        <!-- Header -->
        <header class="flex justify-between items-center p-6 flex-shrink-0">
            <div id="page-title" class="text-2xl font-bold">Wallet</div>
            <button onclick="showPage('profile')" class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
            </button>
        </header>

        <!-- Main Content (Scrollable) -->
        <main class="flex-1 p-6 pt-0 overflow-y-auto">
            
            <!-- Home/Wallet Page -->
            <div id="home" class="page space-y-6">
                <div id="wallet-budget-warning" class="hidden"></div>
                <div class="bg-card p-6 rounded-2xl">
                    <p class="text-gray-500 text-sm">Total Balance</p>
                    <p id="current-balance" class="text-4xl font-extrabold">RM 0.00</p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="showPage('income')" class="bg-card p-4 rounded-xl text-center hover:bg-gray-100 transition-colors">
                        üí∞
                        <span class="block font-semibold mt-1">Add/Update Income</span>
                    </button>
                    <button onclick="showPage('addExpense')" class="bg-card p-4 rounded-xl text-center hover:bg-gray-100 transition-colors">
                        üí∏
                        <span class="block font-semibold mt-1">Add Expense</span>
                    </button>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Recent Transactions</h3>
                    <div id="transaction-list" class="space-y-4">
                        <!-- Transactions will be injected here -->
                    </div>
                </div>
            </div>

            <!-- Budgeting Page -->
            <div id="budgeting" class="page hidden space-y-6">
                <div id="budget-dashboard" class="hidden space-y-4">
                    <!-- Budget tracking dashboard will be rendered here -->
                </div>
                <div id="budget-setup">
                    <!-- Step 1: Income -->
                    <div class="bg-card p-6 rounded-2xl mb-6">
                        <div class="flex items-start space-x-4">
                            <img src="https://i.imgur.com/80z2Z5c.png" alt="Lulu Mascot" class="w-16 h-16 -mt-2" onerror="this.onerror=null;this.src='https://placehold.co/64x64/E60073/FFFFFF?text=L';">
                            <div>
                                <h3 class="text-lg font-bold">Step 1: Your Monthly Income</h3>
                                <p class="text-gray-500 text-sm">‚ÄúLet‚Äôs count your money first, meow~‚Äù</p>
                            </div>
                        </div>
                        <div id="budget-income-list" class="my-4 space-y-2"></div>
                        <button onclick="addBudgetIncomeSource()" class="text-sm text-primary font-semibold">+ Add Income Source</button>
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <div class="flex justify-between items-center">
                                <span class="font-bold">Total Monthly Income:</span>
                                <span id="budget-total-income" class="font-bold text-lg">RM 0.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Expenses -->
                    <div class="bg-card p-6 rounded-2xl mb-6">
                         <div class="flex items-start space-x-4">
                            <img src="https://i.imgur.com/80z2Z5c.png" alt="Lulu Mascot" class="w-16 h-16 -mt-2" onerror="this.onerror=null;this.src='https://placehold.co/64x64/E60073/FFFFFF?text=L';">
                            <div>
                                <h3 class="text-lg font-bold">Step 2: Plan Monthly Expenses</h3>
                                <p class="text-gray-500 text-sm">‚ÄúWhere does your money go? Let‚Äôs list it down!‚Äù</p>
                            </div>
                        </div>
                        <div id="budget-expense-list" class="my-4 space-y-2"></div>
                        <button onclick="addBudgetExpenseCategory()" class="text-sm text-primary font-semibold">+ Add Category</button>
                         <div class="mt-4 pt-4 border-t border-gray-200">
                            <div class="flex justify-between items-center">
                                <span class="font-bold">Total Planned Expenses:</span>
                                <span id="budget-total-expenses" class="font-bold text-lg">RM 0.00</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Step 3: Set Limit -->
                     <div class="bg-card p-6 rounded-2xl text-center">
                         <h3 class="text-lg font-bold">Step 3: Set a Spending Limit</h3>
                         <p class="text-gray-500 text-sm mt-1">This includes planned and unplanned expenses.</p>
                          <div class="my-4">
                            <input type="number" id="spending-limit-input" placeholder="e.g., 1500" class="w-full text-center text-2xl font-bold bg-gray-100 p-2 rounded-lg border-gray-200 focus:ring-primary focus:border-primary">
                          </div>
                         <button onclick="setBudget()" class="btn-primary font-bold py-3 px-6 rounded-lg w-full">Set Limit & Start Tracking</button>
                     </div>
                </div>
            </div>

            <!-- Saving Page -->
            <div id="saving" class="page hidden space-y-6">
                <div id="saving-goals-list" class="space-y-6">
                    <!-- Active goals will be rendered here -->
                </div>
                <div id="saving-empty-state" class="text-center hidden">
                     <img src="https://i.imgur.com/80z2Z5c.png" alt="Lulu Mascot" class="w-24 h-24 mx-auto mb-4" onerror="this.onerror=null;this.src='https://placehold.co/96x96/E60073/FFFFFF?text=L';">
                    <h3 class="text-xl font-bold">Set a Goal, Save Smarter!</h3>
                    <p class="text-gray-500 mt-2 mb-4">You don't have any active savings goals yet.</p>
                </div>
                <button onclick="showPage('addSavingGoal')" class="btn-primary font-bold py-3 px-6 rounded-lg w-full">Create New Savings Goal</button>
            </div>

            <!-- Investing Page -->
            <div id="investing" class="page hidden space-y-6">
                <div id="investment-content">
                    <!-- Investment content will be rendered here -->
                </div>
            </div>

            <!-- Data Defender Page -->
            <div id="dataDefender" class="page hidden">
                <div class="bg-card rounded-2xl p-6">
                    <p class="text-gray-500 mb-4">Paste a suspicious link below to check for red flags.</p>
                    <div class="flex space-x-2">
                        <input type="text" id="link-input" placeholder="https://your-suspicious-link.com" class="flex-grow min-w-0 bg-gray-100 border border-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-primary focus:outline-none">
                        <button onclick="analyzeLink()" class="btn-primary font-bold py-3 px-6 rounded-lg">Check</button>
                    </div>
                    <div id="analysis-result" class="mt-6"></div>
                </div>
            </div>

            <!-- Income Tracker Page -->
            <div id="income" class="page hidden">
                <div class="bg-card rounded-2xl p-6">
                    <form id="income-form" class="space-y-6">
                        <div>
                            <label for="monthly-salary" class="block text-sm font-medium text-gray-600 mb-2">Monthly Salary (<span class="currency-label">RM</span>)</label>
                            <input type="number" id="monthly-salary" placeholder="e.g., 3000" class="w-full bg-gray-100 border border-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-primary focus:outline-none">
                        </div>
                        <div>
                            <label for="other-income" class="block text-sm font-medium text-gray-600 mb-2">Other Monthly Income (<span class="currency-label">RM</span>)</label>
                            <input type="number" id="other-income" placeholder="e.g., 500" class="w-full bg-gray-100 border border-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-primary focus:outline-none">
                        </div>
                        <button type="submit" class="w-full btn-primary font-bold py-3 rounded-lg">Save Income</button>
                    </form>
                    <div id="income-success-message" class="mt-4 text-center text-green-500 hidden">Income updated!</div>
                </div>
            </div>

            <!-- Add Expense Page -->
            <div id="addExpense" class="page hidden">
                <div class="bg-card rounded-2xl p-6">
                    <form id="expense-form" class="space-y-6">
                        <div>
                            <label for="expense-name" class="block text-sm font-medium text-gray-600 mb-2">What is this expense for?</label>
                            <input type="text" id="expense-name" placeholder="e.g., Lunch, Movie tickets" class="w-full bg-gray-100 border border-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-primary focus:outline-none" required>
                        </div>
                        <div>
                            <label for="expense-amount" class="block text-sm font-medium text-gray-600 mb-2">Amount (<span class="currency-label">RM</span>)</label>
                            <input type="number" id="expense-amount" placeholder="e.g., 15.50" class="w-full bg-gray-100 border border-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-primary focus:outline-none" required>
                        </div>
                        <button type="submit" class="w-full btn-primary font-bold py-3 rounded-lg">Add Expense</button>
                    </form>
                </div>
            </div>
            
            <!-- Add Saving Goal Page -->
            <div id="addSavingGoal" class="page hidden">
                <div class="bg-card rounded-2xl p-6">
                    <h3 class="text-xl font-bold mb-4">Create a New Savings Goal</h3>
                    <form id="saving-goal-form" class="space-y-6">
                        <div>
                            <label for="saving-goal-name" class="block text-sm font-medium text-gray-600 mb-2">What are you saving for?</label>
                            <input type="text" id="saving-goal-name" placeholder="e.g., New Phone" class="w-full bg-gray-100 border border-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-primary focus:outline-none" required>
                        </div>
                        <div>
                            <label for="saving-target-amount" class="block text-sm font-medium text-gray-600 mb-2">How much do you need? (<span class="currency-label">RM</span>)</label>
                            <input type="number" id="saving-target-amount" placeholder="e.g., 1500" class="w-full bg-gray-100 border border-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-primary focus:outline-none" required>
                        </div>
                        <div>
                            <label for="saving-monthly-contribution" class="block text-sm font-medium text-gray-600 mb-2">How much can you save per month? (<span class="currency-label">RM</span>)</label>
                            <input type="number" id="saving-monthly-contribution" placeholder="e.g., 250" class="w-full bg-gray-100 border border-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-primary focus:outline-none" required>
                        </div>
                        <div>
                            <label for="saving-payment-day" class="block text-sm font-medium text-gray-600 mb-2">Choose a payment day (1-28)</label>
                            <input type="number" id="saving-payment-day" min="1" max="28" placeholder="e.g., 25" class="w-full bg-gray-100 border border-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-primary focus:outline-none" required>
                        </div>
                        <div id="saving-estimate" class="text-center text-gray-600 bg-gray-100 p-3 rounded-lg hidden"></div>
                        <button type="submit" class="w-full btn-primary font-bold py-3 rounded-lg">Start Saving!</button>
                    </form>
                </div>
            </div>

            <!-- Profile Page -->
            <div id="profile" class="page hidden space-y-6">
                <div class="bg-card p-6 rounded-2xl">
                    <h3 class="text-xl font-bold mb-4">Your Profile</h3>
                    <div class="space-y-3">
                        <div>
                            <p class="text-sm text-gray-500">Name</p>
                            <p id="profile-name" class="font-semibold"></p>
                        </div>
                         <div>
                            <p class="text-sm text-gray-500">Email</p>
                            <p id="profile-email" class="font-semibold"></p>
                        </div>
                         <div>
                            <p class="text-sm text-gray-500">Country</p>
                            <p id="profile-country" class="font-semibold"></p>
                        </div>
                    </div>
                </div>
                <!-- UPDATED LINK TO NEW PAGE -->
                <a href="financial_graphs.html" class="block text-center w-full btn-primary font-bold py-3 rounded-lg">Financial Graphs</a>
                <button id="logout-button-profile" class="w-full bg-gray-200 text-gray-700 font-bold py-3 rounded-lg">Logout</button>
            </div>
        </main>

        <!-- Bottom Navigation (Sticky) -->
        <nav class="bg-card p-2 overflow-x-auto whitespace-nowrap hide-scrollbar flex-shrink-0">
            <div class="flex mx-auto space-x-2">
                <a href="#" onclick="showPage('home')" data-title="Wallet" class="nav-link active flex flex-col items-center text-gray-500 p-3 rounded-lg flex-shrink-0 w-24 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-7 h-7 mb-1"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"></path><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"></path><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"></path></svg>
                    <span class="text-sm font-medium">Wallet</span>
                </a>
                <a href="#" onclick="showPage('budgeting')" data-title="Budgeting" class="nav-link flex flex-col items-center text-gray-500 p-3 rounded-lg flex-shrink-0 w-24 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-7 h-7 mb-1"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></svg>
                    <span class="text-sm font-medium">Budget</span>
                </a>
                <a href="#" onclick="showPage('saving')" data-title="Saving" class="nav-link flex flex-col items-center text-gray-500 p-3 rounded-lg flex-shrink-0 w-24 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-7 h-7 mb-1"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="M12 8v4l2 2"></path></svg>
                    <span class="text-sm font-medium">Saving</span>
                </a>
                <a href="#" onclick="showPage('investing')" data-title="Investing" class="nav-link flex flex-col items-center text-gray-500 p-3 rounded-lg flex-shrink-0 w-24 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-7 h-7 mb-1"><line x1="12" y1="20" x2="12" y2="10"></line><line x1="18" y1="20" x2="18" y2="4"></line><line x1="6" y1="20" x2="6" y2="16"></line></svg>
                    <span class="text-sm font-medium">Investing</span>
                </a>
                <a href="#" onclick="showPage('dataDefender')" data-title="Defender" class="nav-link flex flex-col items-center text-gray-500 p-3 rounded-lg flex-shrink-0 w-24 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24" 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                    <span class="text-sm font-medium">Defender</span>
                </a>
            </div>
        </nav>
    </div>

    <script type="module">
        // --- DATA & STATE MANAGEMENT ---
        let transactions = [];
        let savingsGoals = [];
        let budget = null;
        let currentUser = null;
        let currencySymbol = 'RM';
        const pageTitleEl = document.getElementById('page-title');
        const navLinks = document.querySelectorAll('.nav-link');
        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');

        function loadData() {
            if (!currentUser) return;
            const email = currentUser.email;
            transactions = JSON.parse(localStorage.getItem(`finshieldTransactions_${email}`)) || [];
            savingsGoals = JSON.parse(localStorage.getItem(`finshieldSavingsGoals_${email}`)) || [];
            budget = JSON.parse(localStorage.getItem(`finshieldBudget_${email}`)) || null;
        }

        function saveData() {
            if (!currentUser) return;
            const email = currentUser.email;
            localStorage.setItem(`finshieldTransactions_${email}`, JSON.stringify(transactions));
            localStorage.setItem(`finshieldSavingsGoals_${email}`, JSON.stringify(savingsGoals));
            localStorage.setItem(`finshieldBudget_${email}`, JSON.stringify(budget));
        }

        // --- AUTHENTICATION ---
        function showAuthPage(pageId) {
            document.querySelectorAll('.auth-page').forEach(p => p.classList.add('hidden'));
            document.getElementById(pageId).classList.remove('hidden');
        }
        window.showAuthPage = showAuthPage;

        function checkLoginStatus() {
            const userEmail = localStorage.getItem('finshieldCurrentUser');
            const urlParams = new URLSearchParams(window.location.search);
            const resetToken = urlParams.get('resetToken');

            if (resetToken) {
                const tokenData = JSON.parse(localStorage.getItem(`finshieldResetToken`));
                if (tokenData && tokenData.token === resetToken && Date.now() < tokenData.expiry) {
                    showAuthPage('reset-password-page');
                } else {
                    alert("Password reset link is invalid or has expired.");
                    window.location.search = ''; // Clear the token from URL
                }
                return;
            }

            if (userEmail) {
                currentUser = JSON.parse(localStorage.getItem(`finshieldUser_${userEmail}`));
                if (currentUser) {
                    currencySymbol = currentUser.country === 'Indonesia' ? 'IDR' : 'RM';
                    document.querySelectorAll('.currency-label').forEach(el => el.textContent = currencySymbol);
                    authContainer.classList.add('hidden');
                    appContainer.classList.add('flex');
                    appContainer.classList.remove('hidden');
                    loadData();
                    updateAll();
                    return;
                }
            }
            authContainer.classList.remove('hidden');
            appContainer.classList.add('hidden');
            appContainer.classList.remove('flex');
        }

        function logout() {
            localStorage.removeItem('finshieldCurrentUser');
            currentUser = null;
            location.reload();
        }
        document.getElementById('logout-button-profile').addEventListener('click', logout);


        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const user = JSON.parse(localStorage.getItem(`finshieldUser_${email}`));
            const errorEl = document.getElementById('login-error');

            if (user && user.password === password) {
                localStorage.setItem('finshieldCurrentUser', email);
                checkLoginStatus();
            } else {
                errorEl.textContent = 'Invalid email or password.';
                errorEl.classList.remove('hidden');
            }
        });

        document.getElementById('register-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const country = document.getElementById('register-country').value;
            const errorEl = document.getElementById('register-error');

            if (!country) {
                errorEl.textContent = 'Please select a country.';
                errorEl.classList.remove('hidden');
                return;
            }

            if (localStorage.getItem(`finshieldUser_${email}`)) {
                errorEl.textContent = 'An account with this email already exists.';
                errorEl.classList.remove('hidden');
                return;
            }
            
            const newUser = { name, email, password, country };
            localStorage.setItem(`finshieldUser_${email}`, JSON.stringify(newUser));
            localStorage.setItem('finshieldCurrentUser', email);
            checkLoginStatus();
        });
        
        document.getElementById('forgot-password-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('forgot-email').value;
            const successEl = document.getElementById('forgot-success');
            const errorEl = document.getElementById('forgot-error');
            
            if (localStorage.getItem(`finshieldUser_${email}`)) {
                 errorEl.classList.add('hidden');
                 const token = `reset_${email}_${Date.now()}`;
                 const expiry = Date.now() + 15 * 60 * 1000; // 15 minutes
                 localStorage.setItem('finshieldResetToken', JSON.stringify({ email, token, expiry }));

                 const resetLink = `${window.location.origin}${window.location.pathname}?resetToken=${token}`;
                 
                 successEl.innerHTML = `An email simulation from <strong>finshieldtech.jp@gmail.com</strong>:<br>Click the button below to reset your password.<br><br>
                    <a href="${resetLink}" class="btn-primary inline-block font-bold py-2 px-4 rounded-lg">Reset Password</a>`;
                 successEl.classList.remove('hidden');
            } else {
                 successEl.classList.add('hidden');
                 errorEl.textContent = 'No account found with that email.';
                 errorEl.classList.remove('hidden');
            }
        });

        document.getElementById('reset-password-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const newPassword = document.getElementById('reset-password').value;
            const confirmPassword = document.getElementById('reset-password-confirm').value;
            const errorEl = document.getElementById('reset-error');
            const tokenData = JSON.parse(localStorage.getItem('finshieldResetToken'));

            if (newPassword !== confirmPassword) {
                errorEl.textContent = "Passwords do not match.";
                errorEl.classList.remove('hidden');
                return;
            }

            const user = JSON.parse(localStorage.getItem(`finshieldUser_${tokenData.email}`));
            user.password = newPassword;
            localStorage.setItem(`finshieldUser_${tokenData.email}`, JSON.stringify(user));
            
            localStorage.removeItem('finshieldResetToken');
            localStorage.setItem('finshieldCurrentUser', user.email);
            window.location.search = ''; // This will reload the page and log the user in
        });


        // --- PAGE NAVIGATION ---
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.add('hidden'));
            const newPage = document.getElementById(pageId);
            newPage.classList.remove('hidden');
            
            const pageTitles = {
                home: 'Wallet', budgeting: 'Budgeting', saving: 'Saving', investing: 'Investing',
                dataDefender: 'Defender', income: 'Update Income', addExpense: 'Add Expense',
                addSavingGoal: 'New Saving Goal', profile: 'Profile'
            };
            pageTitleEl.textContent = pageTitles[pageId] || 'FinShield';

            navLinks.forEach(link => {
                link.classList.toggle('active', link.getAttribute('onclick').includes(`'${pageId}'`));
            });
            
            if (pageId === 'saving') renderSavingGoals();
            if (pageId === 'budgeting') renderBudgetPage();
            if (pageId === 'investing') updateInvestingPage();
            if (pageId === 'profile') renderProfilePage();
        }
        window.showPage = showPage;
        
        // --- PROFILE PAGE ---
        function renderProfilePage() {
            if (currentUser) {
                document.getElementById('profile-name').textContent = currentUser.name;
                document.getElementById('profile-email').textContent = currentUser.email;
                document.getElementById('profile-country').textContent = currentUser.country;
            }
        }

        // --- RENDER & UPDATE FUNCTIONS ---
        function formatCurrency(amount) {
            if (currencySymbol === 'IDR') {
                return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(amount);
            }
            return `${currencySymbol} ${amount.toFixed(2)}`;
        }

        function renderTransactions() {
            const transactionList = document.getElementById('transaction-list');
            if (transactions.length === 0) {
                transactionList.innerHTML = `<p class="text-gray-500 text-center">No transactions yet.</p>`;
                return;
            }
            transactionList.innerHTML = transactions.slice().reverse().map(tx => {
                const isIncome = tx.type === 'income';
                const amountColor = isIncome ? 'text-green-500' : tx.type === 'saving' ? 'text-blue-500' : '';
                const sign = isIncome ? '+' : '-';
                const icon = isIncome ? 'üíº' : (tx.type === 'saving' ? 'üéØ' : 'üí∏');
                return `
                <div class="flex items-center bg-card p-4 rounded-xl">
                    <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-xl mr-4">${icon}</div>
                    <div class="flex-1">
                        <p class="font-bold">${tx.name}</p>
                        <p class="text-sm text-gray-500">${new Date(tx.date).toLocaleDateString()}</p>
                    </div>
                    <p class="font-bold ${amountColor}">${sign}${formatCurrency(Math.abs(tx.amount))}</p>
                </div>`;
            }).join('');
        }

        function updateBalance() {
            const totalBalance = transactions.reduce((sum, tx) => sum + tx.amount, 0);
            document.getElementById('current-balance').textContent = formatCurrency(totalBalance);
            return totalBalance;
        }
        
        // --- FORM SUBMISSIONS ---
        document.getElementById('income-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const salary = parseFloat(document.getElementById('monthly-salary').value) || 0;
            const other = parseFloat(document.getElementById('other-income').value) || 0;
            const totalIncome = salary + other;
            if (totalIncome > 0) {
                transactions.push({ name: 'Monthly Income', amount: totalIncome, type: 'income', date: new Date() });
                saveData();
                updateAll();
                showPage('home');
            }
        });

        document.getElementById('expense-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('expense-name').value;
            const amount = parseFloat(document.getElementById('expense-amount').value);
            if (name && amount > 0) {
                transactions.push({ name: name, amount: -amount, type: 'expense', date: new Date() });
                saveData();
                updateAll();
                e.target.reset();
                showPage('home');
            }
        });
        
        document.getElementById('saving-goal-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const newGoal = {
                id: Date.now(),
                name: document.getElementById('saving-goal-name').value,
                targetAmount: parseFloat(document.getElementById('saving-target-amount').value),
                monthlyContribution: parseFloat(document.getElementById('saving-monthly-contribution').value),
                paymentDay: parseInt(document.getElementById('saving-payment-day').value),
                savedAmount: 0,
            };
            savingsGoals.push(newGoal);
            saveData();
            updateAll();
            e.target.reset();
            showPage('saving');
        });

        // --- SAVING GOAL LOGIC ---
        function renderSavingGoals() {
            const listDiv = document.getElementById('saving-goals-list');
            const emptyDiv = document.getElementById('saving-empty-state');

            if (savingsGoals.length === 0) {
                listDiv.innerHTML = '';
                emptyDiv.classList.remove('hidden');
                return;
            }
            
            emptyDiv.classList.add('hidden');
            listDiv.innerHTML = savingsGoals.map(goal => {
                const { id, name, targetAmount, savedAmount, monthlyContribution, paymentDay } = goal;
                const progress = (savedAmount / targetAmount) * 100;
                const amountLeft = targetAmount - savedAmount;
                const monthsLeft = Math.ceil(amountLeft / monthlyContribution);
                let reminder = '';
                if (new Date().getDate() === paymentDay) {
                    reminder = `<div class="p-3 mb-4 bg-yellow-100 text-yellow-700 rounded-lg text-center font-semibold">üîî Today is your monthly savings day for "${name}"!</div>`;
                }
                return `
                    <div class="space-y-4 mb-6">
                        ${reminder}
                        <div class="bg-card p-6 rounded-2xl">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-xl font-bold">${name}</h3>
                                <span class="font-bold text-primary">${progress.toFixed(0)}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-primary h-2.5 rounded-full" style="width: ${progress}%"></div></div>
                            <div class="flex justify-between text-sm mt-2">
                                <span>Saved: ${formatCurrency(savedAmount)}</span>
                                <span>Target: ${formatCurrency(targetAmount)}</span>
                            </div>
                        </div>
                        <div class="bg-card p-6 rounded-2xl">
                            <h4 class="font-bold mb-2">Your Progress</h4>
                            <p class="text-gray-500 text-sm">With your current plan, you'll reach your goal in about:</p>
                            <p class="text-2xl font-bold text-primary mt-1">${monthsLeft} months</p>
                            <button onclick="makeSavingsPayment(${id}, ${monthlyContribution})" class="btn-primary font-bold py-3 w-full rounded-lg mt-4">Save ${formatCurrency(monthlyContribution)} Now</button>
                        </div>
                        <div class="text-center">
                            <button onclick="promptCancelSavingGoal(${id})" class="text-sm text-red-500 font-semibold">Cancel this Goal</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        window.makeSavingsPayment = makeSavingsPayment;
        
        function makeSavingsPayment(goalId, amount) {
            if (updateBalance() < amount) {
                alert("Not enough balance to make this savings payment.");
                return;
            }
            const goal = savingsGoals.find(g => g.id === goalId);
            if (goal) {
                goal.savedAmount += amount;
                transactions.push({ name: `Saving for ${goal.name}`, amount: -amount, type: 'saving', date: new Date() });
                saveData();
                updateAll();
                renderSavingGoals();
            }
        }

        function promptCancelSavingGoal(goalId) {
            if (confirm("Are you sure you want to cancel this savings goal?")) {
                savingsGoals = savingsGoals.filter(g => g.id !== goalId);
                saveData();
                renderSavingGoals();
            }
        }
        window.promptCancelSavingGoal = promptCancelSavingGoal;
        
        function calculateSavingEstimate() {
             const target = parseFloat(document.getElementById('saving-target-amount').value) || 0;
             const contribution = parseFloat(document.getElementById('saving-monthly-contribution').value) || 0;
             const estimateDiv = document.getElementById('saving-estimate');
             if (target > 0 && contribution > 0) {
                const months = Math.ceil(target / contribution);
                estimateDiv.textContent = `Estimated time to reach goal: ${months} months.`;
                estimateDiv.classList.remove('hidden');
             } else {
                estimateDiv.classList.add('hidden');
             }
        }
        document.getElementById('addSavingGoal').addEventListener('input', calculateSavingEstimate);

        // --- BUDGETING PAGE LOGIC ---
        function renderBudgetPage() {
            const dashboard = document.getElementById('budget-dashboard');
            const setup = document.getElementById('budget-setup');
            if (budget && budget.limit > 0) {
                setup.classList.add('hidden');
                dashboard.classList.remove('hidden');
                renderBudgetDashboard();
            } else {
                dashboard.classList.add('hidden');
                setup.classList.remove('hidden');
            }
        }

        function renderBudgetDashboard() {
            const totalExpenses = transactions
                .filter(tx => tx.type === 'expense' && new Date(tx.date).getMonth() === new Date().getMonth())
                .reduce((sum, tx) => sum + Math.abs(tx.amount), 0);
            
            const progress = (totalExpenses / budget.limit) * 100;
            const isOverLimit = progress > 100;
            
            let warningHTML = '';
            if (isOverLimit) {
                warningHTML = `<div class="p-3 bg-red-100 text-red-700 rounded-lg text-center font-semibold">
                    üö® Warning! You've exceeded your spending limit!
                </div>`;
            }
            document.getElementById('wallet-budget-warning').innerHTML = warningHTML;
            document.getElementById('wallet-budget-warning').classList.toggle('hidden', !isOverLimit);

            document.getElementById('budget-dashboard').innerHTML = `
                ${warningHTML}
                <div class="bg-card p-6 rounded-2xl">
                    <h3 class="text-xl font-bold">Monthly Spending</h3>
                    <div class="w-full bg-gray-200 rounded-full h-4 mt-4">
                        <div class="bg-${isOverLimit ? 'red' : 'primary'}-500 h-4 rounded-full" style="width: ${Math.min(progress, 100)}%"></div>
                    </div>
                    <div class="flex justify-between text-sm mt-2">
                        <span>Spent: ${formatCurrency(totalExpenses)}</span>
                        <span>Limit: ${formatCurrency(budget.limit)}</span>
                    </div>
                </div>
                <button onclick="resetBudget()" class="text-sm text-gray-500 text-center w-full">Reset Budget</button>
            `;
        }
        window.resetBudget = resetBudget;
        
        function resetBudget() {
            budget = null;
            saveData();
            renderBudgetPage();
            document.getElementById('wallet-budget-warning').classList.add('hidden');
        }

        function setBudget() {
            const limit = parseFloat(document.getElementById('spending-limit-input').value);
            if (limit > 0) {
                budget = { limit: limit };
                saveData();
                renderBudgetPage();
            }
        }
        window.setBudget = setBudget;

        function addBudgetIncomeSource() {
            const list = document.getElementById('budget-income-list');
            const newSource = document.createElement('div');
            newSource.className = 'flex items-center space-x-2';
            newSource.innerHTML = `<input type="text" placeholder="e.g., Allowance" class="flex-1 min-w-0 bg-gray-100 p-2 rounded-lg"><input type="number" placeholder="500" class="w-32 bg-gray-100 p-2 rounded-lg">`;
            list.appendChild(newSource);
        }
        window.addBudgetIncomeSource = addBudgetIncomeSource;
        
        function addBudgetExpenseCategory() {
            const list = document.getElementById('budget-expense-list');
            const newCat = document.createElement('div');
            newCat.className = 'flex items-center space-x-2';
            newCat.innerHTML = `
                <input type="text" placeholder="e.g., Food" class="flex-1 min-w-0 bg-gray-100 p-2 rounded-lg border-gray-200 focus:ring-primary focus:border-primary">
                <input type="number" placeholder="400" class="w-32 bg-gray-100 p-2 rounded-lg border-gray-200 focus:ring-primary focus:border-primary">
            `;
            list.appendChild(newCat);
        }
        window.addBudgetExpenseCategory = addBudgetExpenseCategory;

        function calculateBudgetSetup() {
            let totalIncome = 0;
            document.querySelectorAll('#budget-income-list input[type="number"]').forEach(input => { totalIncome += parseFloat(input.value) || 0; });
            document.getElementById('budget-total-income').textContent = formatCurrency(totalIncome);
            let totalExpenses = 0;
            document.querySelectorAll('#budget-expense-list input[type="number"]').forEach(input => { totalExpenses += parseFloat(input.value) || 0; });
            document.getElementById('budget-total-expenses').textContent = formatCurrency(totalExpenses);
        }
        document.getElementById('budgeting').addEventListener('input', calculateBudgetSetup);

        // --- INVESTING PAGE LOGIC ---
        function updateInvestingPage() {
            const contentDiv = document.getElementById('investment-content');
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();

            const monthlyIncome = transactions
                .filter(tx => tx.type === 'income' && new Date(tx.date).getMonth() === currentMonth && new Date(tx.date).getFullYear() === currentYear)
                .reduce((sum, tx) => sum + tx.amount, 0);
            
            const monthlyExpenses = transactions
                .filter(tx => tx.type === 'expense' && new Date(tx.date).getMonth() === currentMonth && new Date(tx.date).getFullYear() === currentYear)
                .reduce((sum, tx) => sum + Math.abs(tx.amount), 0);

            const monthlySavings = transactions
                .filter(tx => tx.type === 'saving' && new Date(tx.date).getMonth() === currentMonth && new Date(tx.date).getFullYear() === currentYear)
                .reduce((sum, tx) => sum + Math.abs(tx.amount), 0);
            
            const potentialInvestment = monthlyIncome - monthlyExpenses - monthlySavings;

            let recommendationHTML = '';
            if (potentialInvestment <= 0) {
                recommendationHTML = `
                    <div class="bg-card p-6 rounded-2xl text-center">
                        <img src="https://i.imgur.com/80z2Z5c.png" alt="Lulu Mascot" class="w-24 h-24 mx-auto mb-4" onerror="this.onerror=null;this.src='https://placehold.co/96x96/E60073/FFFFFF?text=L';">
                        <h3 class="text-xl font-bold">Focus on Budgeting First!</h3>
                        <p class="text-gray-500 mt-2">It looks like you don't have extra cash this month. Let's work on your budget to free up some funds for investing!</p>
                    </div>
                `;
            } else {
                 let platformSuggestion = '';
                 if (potentialInvestment < 100) {
                     platformSuggestion = `
                        <h4 class="font-bold text-lg mt-4">Where to Start?</h4>
                        <p class="text-gray-600">With this amount, you can start small! Try micro-investing apps that let you invest with very little money.</p>
                        <p class="font-semibold mt-2">Platforms to check out: <strong>Raiz, Bibit (Mutual Funds)</strong></p>
                     `;
                 } else if (potentialInvestment >= 100 && potentialInvestment < 500) {
                      platformSuggestion = `
                        <h4 class="font-bold text-lg mt-4">Where to Start?</h4>
                        <p class="text-gray-600">You have a solid amount to begin! Robo-advisors are a great, hands-off way to get started in a diversified portfolio.</p>
                        <p class="font-semibold mt-2">Platforms to check out: <strong>StashAway, Wahed Invest</strong></p>
                     `;
                 } else {
                      platformSuggestion = `
                        <h4 class="font-bold text-lg mt-4">Where to Start?</h4>
                        <p class="text-gray-600">You're in a great position! You can explore robo-advisors for ease, or look into individual stocks or ETFs for more control.</p>
                        <p class="font-semibold mt-2">Platforms to check out: <strong>Interactive Brokers, GoTrade, Pluang</strong></p>
                     `;
                 }

                recommendationHTML = `
                    <div class="bg-card p-6 rounded-2xl text-center">
                         <p class="text-gray-500 text-sm">Based on your activity this month...</p>
                         <h3 class="text-lg font-bold">Your Potential Investment Amount is:</h3>
                         <p class="text-4xl font-extrabold text-primary my-2">${formatCurrency(potentialInvestment)}</p>
                         <p class="text-gray-500 text-xs">(Income - Expenses - Savings)</p>
                    </div>
                    <div class="bg-card p-6 rounded-2xl">
                        ${platformSuggestion}
                         <p class="text-xs text-gray-400 mt-4">Disclaimer: This is not financial advice. Platform availability may vary by country.</p>
                    </div>
                `;
            }
            contentDiv.innerHTML = recommendationHTML;
        }

        // --- DATA DEFENDER ---
        function analyzeLink() {
            const link = document.getElementById('link-input').value;
            const resultDiv = document.getElementById('analysis-result');
            resultDiv.innerHTML = '';
            if (!link) { resultDiv.innerHTML = `<p class="text-yellow-500">Please enter a link.</p>`; return; }
            
            let findings = [];
            // Scam/Phishing Keywords
            ['login', 'verify', 'account', 'update', 'free', 'win', 'prize', 'lucky', 'hadiah', 'undian', 'klik', 'disini', 'secure', 'support'].forEach(k => {
                if (link.toLowerCase().includes(k)) findings.push({ type: 'warning', text: `Link contains a common scam keyword: "${k}".` });
            });
            // Data Theft Keywords
            ['.zip', '.exe', '.apk', '.rar', 'download', 'install', 'update-browser', 'security-alert'].forEach(k => {
                if (link.toLowerCase().includes(k)) findings.push({ type: 'danger', text: `Potential data theft risk: link contains "${k}".` });
            });
            // Online Gambling Keywords
            ['judi', 'slot', 'gacor', 'casino', 'poker', 'togel', 'bet', 'taruhan', 'maxwin', 'rtp'].forEach(k => {
                if (link.toLowerCase().includes(k)) findings.push({ type: 'danger', text: `Prohibited Content: Link related to online gambling.` });
            });
            // General checks
            if (!link.startsWith('https://')) { findings.push({ type: 'danger', text: 'Link does not use secure HTTPS.' }); } 
            ['bit.ly', 'tinyurl.com'].forEach(s => { if (link.includes(s)) { findings.push({ type: 'warning', text: `Uses a URL shortener which can hide the real destination.` }); } });

            let resultHTML = '<h4 class="font-bold text-lg mb-3">Analysis Report</h4>';
            const dangers = findings.filter(f => f.type === 'danger');
            const warnings = findings.filter(f => f.type === 'warning');

            if (dangers.length > 0) {
                resultHTML += `<div class="p-4 rounded-lg bg-red-100"><h5 class="font-bold text-red-600">üö® High Risk!</h5><p class="text-sm text-red-500">This link is in a prohibited category. Avoid opening it.</p></div>`;
            } else if (warnings.length > 0) {
                resultHTML += `<div class="p-4 rounded-lg bg-yellow-100"><h5 class="font-bold text-yellow-600">‚ö†Ô∏è Caution Advised</h5><p class="text-sm text-yellow-500">This link has suspicious characteristics. Proceed carefully.</p></div>`;
            } else {
                resultHTML += `<div class="p-4 rounded-lg bg-green-100"><h5 class="font-bold text-green-600">‚úÖ Low Risk</h5><p class="text-sm text-green-500">No major red flags found, but always stay vigilant.</p></div>`;
            }
            
            if (findings.length > 0) {
                resultHTML += '<ul class="space-y-2 mt-4 text-sm">';
                findings.forEach(f => {
                    let colorClass = f.type === 'danger' ? 'text-red-500' : 'text-yellow-500';
                    resultHTML += `<li class="${colorClass}"><strong>${f.type.charAt(0).toUpperCase() + f.type.slice(1)}:</strong> ${f.text}</li>`;
                });
                resultHTML += '</ul>';
            }
            resultDiv.innerHTML = resultHTML;
        }
        window.analyzeLink = analyzeLink;

        // --- INITIALIZATION ---
        function updateAll() {
            updateBalance();
            renderTransactions();
            renderBudgetPage();
            renderSavingGoals();
            updateInvestingPage();
            calculateBudgetSetup();
        }

        window.onload = () => {
            checkLoginStatus();
        };
    </script>
</body>
</html>
